<launch>
    <arg name="ShoulderRotPWM_CH"   value="/HW/SlowPWM/CH0" />
    <arg name="ShoulderPitchPWM_CH" value="/HW/SlowPWM/CH1" />
    <arg name="ElbowPitchPWM_CH"    value="/HW/SlowPWM/CH2" />
    <arg name="WristRotPWM_CH"      value="/HW/SlowPWM/CH5" />
    <arg name="WristPitchPWM_CH"    value="/HW/SlowPWM/CH7" />
    <arg name="ClawActuationPWM_CH" value="/HW/SlowPWM/CH9" />

    <group ns="HW">
        <node name="SlowPWM_HAT" pkg="mavric" type="PCA9685_PWM_HAT.py" respawn="true">
            <param name="container" value="SlowPWM/" />
            <param name="control_mode" value="PulseTime" />
            <param name="frequency" value="250" />
            <!-- addresses start at 0x40 (64) and can be configured on the board -->
            <param name="address" value="64" />
            <!-- we want to run as fast as possible here -->
            <!-- <param name="clk_error" value="1.0893246187363834422657952069717" /> -->
            <param name="clk_error" value="1.04166667" />
        </node>
    </group>

    <group ns="Arm">
        <arg name="ShoulderRot_Scale" value="1.0" />
        <arg name="ShoulderPitch_Scale" value="1.0" />
        <arg name="ElbowPitch_Scale" value="1.0" />
        <arg name="WristRot_Scale" value="1.0" />
        <arg name="WristPitch_Scale" value="1.0" />
        <arg name="ClawActuation_Scale" value="1.0" />

        <node name="Arm_Interface" pkg="mavric" type="Arm_P.py" respawn="true">
            <param name="port" value="10001" />
        </node>

        <node name="ShoulderRot_Ramping" pkg="mavric" type="Ramping.py" >
            <param name="ramp_rate_up" value="300"/>
            <param name="ramp_rate_down" value="400"/>
            <param name="centerpoint" value="0"/>
            <remap from="input" to="ShoulderRot"/>
            <remap from="output" to="ShoulderRotRamped" />
        </node>

        <!-- Each scaling node takes one channel and scales it from +- 100 to the PWM control range--> 
        <node name="ShoulderRot_Scale" pkg="mavric" type="LinearMapping.py">
            <param name="inputs"  value="ShoulderRotRamped" />
            <param name="outputs" value="$(arg ShoulderRotPWM_CH)" />
            <param name="slopes"      value="$(eval ShoulderRot_Scale*0.0005/100)" />
            <param name="intercepts"  value="0.0015" />
        </node>
        <node name="ElbowPitch_Scale" pkg="mavric" type="LinearMapping.py">
            <param name="inputs"  value="ElbowPitch" />
            <param name="outputs" value="$(arg ElbowPitchPWM_CH)" />
            <param name="slopes"      value="$(eval ElbowPitch_Scale*0.0005/100)" />
            <param name="intercepts"  value="0.0015" />
        </node>
        <node name="WristRot_Scale" pkg="mavric" type="LinearMapping.py">
            <param name="inputs"  value="WristRot" />
            <param name="outputs" value="$(arg WristRotPWM_CH)" />
            <param name="slopes"      value="$(eval WristRot_Scale*0.0005/100)" />
            <param name="intercepts"  value="0.0015" />
        </node>
        <node name="WristPitch_Scale" pkg="mavric" type="LinearMapping.py">
            <param name="inputs"  value="WristPitch" />
            <param name="outputs" value="$(arg WristPitchPWM_CH)" />
            <param name="slopes"      value="$(eval WristPitch_Scale*0.0005/100)" />
            <param name="intercepts"  value="0.0015" />
        </node>
        <node name="ClawActuation_Scale" pkg="mavric" type="LinearMapping.py">
            <param name="inputs"  value="ClawActuation" />
            <param name="outputs" value="$(arg ClawActuationPWM_CH)" />
            <param name="slopes"      value="$(eval ClawActuation_Scale*0.0005/100)" />
            <param name="intercepts"  value="0.0015" />
        </node>

        <node name="ShoulderRotHeartbeat" pkg="mavric" type="Float64_Heartbeat.py" >
            <param name="timeout" value="1" />
            <param name="value" value="0" />
            <remap from="topic" to="ShoulderRot" />
        </node>
        <node name="ElbowPitchHeartbeat" pkg="mavric" type="Float64_Heartbeat.py" >
            <param name="timeout" value="1" />
            <param name="value" value="0" />     
            <remap from="topic" to="ElbowPitch" />
        </node>
        <node name="WristPitchHeartbeat" pkg="mavric" type="Float64_Heartbeat.py" >
            <param name="timeout" value="1" />
            <param name="value" value="0" />     
            <remap from="topic" to="WristPitch" />
        </node>
        <node name="WristRotHeartbeat" pkg="mavric" type="Float64_Heartbeat.py" >
            <param name="timeout" value="1" />
            <param name="value" value="0" />     
            <remap from="topic" to="WristRot" />
        </node>
        <node name="ClawActuationHeartbeat" pkg="mavric" type="Float64_Heartbeat.py" >
            <param name="timeout" value="1" />
            <param name="value" value="0" />     
            <remap from="topic" to="ClawActuation" />
        </node>
    </group>
</launch>